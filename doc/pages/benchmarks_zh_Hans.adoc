////
Copyright (c) 2019 Vinnie Falco (vinnie.falco@gmail.com)
Copyright (c) 2025 Dmitry Arkhipov (grisumbras@yandex.ru)

Distributed under the Boost Software License, Version 1.0. (See accompanying
file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)

Official repository: https://github.com/boostorg/json
////

[pagelevels=1,toclevels=1]
= 基准测试
本节将 Boost.JSON 与两个广泛使用的具有相似功能的库进行性能比较：以性能著称的 RapidJSON 和以功能丰富见长的 JSON for Modern C++。基准测试程序测量解析和序列化一组代表典型工作负载的 JSON 的吞吐量。评估的实现如下：

.实现方案
|===
|名称e|描述

| *boost(pool)*
| 使用 <<ref_monotonic_resource>> 解析输入，该资源针对无需后续修改的解析进行了优化。<<ref_stream_parser>> 对象在多次测试间重复使用，允许实现分配的临时内存持续存在以提高性能。

| *boost*
| 使用 <<default_memory_resource, 默认内存资源>> 解析输入，该资源使用标准 C++ 分配器，专为通用场景设计（包括解析后修改文档）。<<ref_stream_parser>> 对象在多次测试间重复使用，允许实现分配的临时内存持续存在以提高性能。

| *rapidjson(pool)*
| 使用 https://rapidjson.org/classrapidjson_1_1_memory_pool_allocator.html[`MemoryPoolAllocator`] 实例解析输入，该分配器针对无需后续修改的解析进行了优化。持有临时内存的 https://rapidjson.org/classrapidjson_1_1_generic_document.html[`Document`] 对象不在测试间重复使用，否则内存消耗将无限增长导致基准测试失效。

| *rapidjson*
| 使用 https://rapidjson.org/classrapidjson_1_1_crt_allocator.html[`CrtAllocator`] 实例解析输入，该分配器使用标准 C++ 分配器，专为通用场景设计（包括解析后修改文档）。持有临时内存的 https://rapidjson.org/classrapidjson_1_1_generic_document.html[`Document`] 对象不在测试间重复使用，否则内存消耗将无限增长导致基准测试失效。

| *nlohmann*
| 使用静态成员函数 https://nlohmann.github.io/json/classnlohmann_1_1basic__json_ab330c13ba254ea41fbc1c52c5c610f45.html[`json::parse`] 解析输入，该函数使用默认的 `std` 分配器，专为通用场景设计（包括解析后修改文档）。该库未提供在后续操作中重复使用解析或序列化期间临时存储的接口。
|===

== 方法论
首先加载所有输入文件。然后对每个配置运行足够次数的测试，确保总耗时至少 5 秒。记录经过时间、调用次数（解析或序列化）和传输字节数作为样本，同时计算以兆字节每秒表示的吞吐量。每个配置生成多个样本（当前为五个）。剔除除中位数两个样本外的所有样本，剩余样本取平均值作为基准测试结果报告。

输入文件位于 bench/data 目录中，具体如下：

.输入文件
|===
|名称e|大小e|描述

| <<parse_apache_builds_json,*apache_builds.json*>>
| 125KB
| 来自 Apache Jenkins 安装的数据。

| <<parse_canada_json,*canada.json*>>
| 2.2MB
| 最大的文件，包含大量存储浮点坐标对的 2 元素数组。

| <<parse_citm_catalog_json,*citm_catalog.json*>>
| 1.69MB
| 包含多种嵌套、类型和长度的大型 JSON。

| <<parse_github_events_json,*github_events.json*>>
| 64KB
| Github Events API 的数据导出。

| <<parse_gsoc_2018_json,*gsoc-2018.json*>>
| 3.25MB
| Google Summer of Code 2018 数据。

| <<parse_instruments_json,*instruments.json*>>
| 216KB
| 大型对象组成的数组。

| <<parse_marine_ik_json,*marine_ik.json*>>
| 2.91MB
| 序列化为 JSON 的 three.js 示例模型。

| <<parse_mesh_json,*mesh.json*>>
| 707KB
| 表示 3D 网格的 JSON。包含大量浮点数。

| <<parse_mesh_pretty_json,*mesh.pretty.json*>>
| 1.54MB
| 添加了空格的 mesh.json。

| <<parse_numbers_json,*numbers.json*>>
| 147KB
| 仅包含浮点数的数组。

| <<parse_random_json,*random.json*>>
| 499KB
| 包含大量西里尔字符的 JSON。

| <<parse_twitter_json,*twitter.json*>>
| 617KB
| Twitter API 的数据导出。

| <<parse_twitterescaped_json,*twitterescaped.json*>>
| 550KB
| 移除空格并将非 ASCII 字符替换为 Unicode 转义符的 twitter.json。

| <<parse_update_center_json,*update-center.json*>>
| 521KB
| Twitter API 的数据导出。
|===

测试使用的硬件：**Intel(R) Core(TM) i7-7700K CPU @ 4.20GHz**，Windows 10 系统，32GB 内存。

编译器及优化标志：gcc 8.1 (-O3)、clang 12.0 (-O3) 和 msvc 19.26 (/O2)。

== 解析

=== 解析 apache_builds.json
image::images/parse_apache_builds.png[width=668,height=712]

=== 解析 canada.json
image::images/parse_canada.png[width=668,height=712]

=== 解析 citm_catalog.json
image::images/parse_citm_catalog.png[width=668,height=712px]

=== 解析 github_events.json
image::images/parse_github_events.png[width=668,height=712]

=== 解析 gsoc-2018.json
image::images/parse_gsoc_2018.png[width=668,height=712]

=== 解析 instruments.json
image::images/parse_instruments.png[width=668,height=712]

=== 解析 marine_ik.json
image::images/parse_marine_ik.png[width=668,height=712]

=== 解析 mesh.json
image::images/parse_mesh.png[width=668,height=712]

=== 解析 mesh.pretty.json
image::images/parse_mesh_pretty.png[width=668,height=712]

=== 解析 numbers.json
image::images/parse_numbers.png[width=668,height=712]

=== 解析 random.json
image::images/parse_random.png[width=668,height=712]

=== 解析 twitter.json
image::images/parse_twitter.png[width=668,height=712]

=== 解析 twitterescaped.json
image::images/parse_twitterescaped.png[width=668,height=712]

=== 解析 update-center.json
image::images/parse_update_center.png[width=668,height=712]

== 序列化

=== 序列化 canada.json
image::images/serialize_canada.png[width=668,height=712]

=== 序列化 citm_catalog.json
image::images/serialize_citm_catalog.png[width=668,height=712]

=== 序列化 github_events.json
image::images/serialize_github_events.png[width=668,height=712]

=== 序列化 gsoc-2018.json
image::images/serialize_gsoc_2018.png[width=668,height=712]

=== 序列化 instruments.json
image::images/serialize_instruments.png[width=668,height=712]

=== 序列化 marine_ik.json
image::images/serialize_marine_ik.png[width=668,height=712]

=== 序列化 mesh.json
image::images/serialize_mesh.png[width=668,height=712]

=== 序列化 mesh.pretty.json
image::images/serialize_mesh_pretty.png[width=668,height=712]

=== 序列化 numbers.json
image::images/serialize_numbers.png[width=668,height=712]

=== 序列化 random.json
image::images/serialize_random.png[width=668,height=712]

=== 序列化 twitter.json
image::images/serialize_twitter.png[width=668,height=712]

=== 序列化 twitterescaped.json
image::images/serialize_twitterescaped.png[width=668,height=712]

=== 序列化 update-center.json
image::images/serialize_update_center.png[width=668,height=712px]
